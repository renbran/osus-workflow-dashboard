<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OSUS Leads Dashboard â€“ Q3 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Recharts -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts@2.8.0/lib/index.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: "Inter", sans-serif; }
    .brand-bg { background: linear-gradient(135deg,#800020 0%,#A0253A 50%,#C04A5C 100%); }
    .brand-gold { background:#D4AF37; }
    .fade-in { animation:fadeIn .6s ease-out forwards }
    @keyframes fadeIn { from {opacity:0;transform:translateY(20px)} to {opacity:1;transform:translateY(0)} }
  </style>
</head>
<body class="bg-gray-900 text-gray-100">

<div id="root">
  <div class="flex items-center justify-center h-screen">
    <div class="text-center">
      <div class="inline-block border-4 border-dashed border-gray-700 rounded-xl p-8">
        <svg class="w-12 h-12 mx-auto mb-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
        </svg>
        <h2 class="text-xl font-bold mb-2">Upload your CSV</h2>
        <input type="file" id="csvFile" accept=".csv" class="hidden">
        <button onclick="document.getElementById('csvFile').click()" class="bg-yellow-500 hover:bg-yellow-600 text-black font-semibold px-6 py-2 rounded-lg">
          Choose File
        </button>
        <p class="text-xs text-gray-400 mt-2">Expected columns: ID,Status,First Name,Created,Source,Agents</p>
      </div>
</div>
</div>

<script type="text/babel">
  const {useState, useEffect} = React;
  const {BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line} = Recharts;

  const Dashboard = () => {
    const [data, setData] = useState([]);
    const [quarter, setQuarter] = useState('Q3');
    const [category, setCategory] = useState('all'); // 'all','conversion','volume','engagement'

    useEffect(() => {
      // Allow drag-drop
      const dropZone = document.getElementById('root');
      const handleDrop = e => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (file) parseCsv(file);
      };
      dropZone.addEventListener('drop', handleDrop);
      dropZone.addEventListener('dragover', e => e.preventDefault());
      document.getElementById('csvFile').addEventListener('change', e => parseCsv(e.target.files[0]));
      return () => dropZone.removeEventListener('drop', handleDrop);
    }, []);

    const parseCsv = file => {
      const reader = new FileReader();
      reader.onload = () => {
        const rows = reader.result.split('\n').slice(1).filter(Boolean);
        const parsed = rows.map(r => {
          const [id, status, name, created, source, agents] = r.split(',').map(s => s.trim().replace(/"/g,''));
          const date = new Date(created);
          const q = `Q${Math.floor((date.getMonth()+3)/3)}`;
          return {id:+id, status, name, date, source, agents, quarter: q};
        });
        setData(parsed);
      };
      reader.readAsText(file);
    };

    const safe = (n, d) => d ? (n/d*100).toFixed(1) : 0;

    const getQuarterData = () => data.filter(d => d.quarter === quarter);

    const getAgents = () => {
      const qd = getQuarterData();
      const grouped = {};
      qd.forEach(d => {
        if (!grouped[d.agents]) grouped[d.agents] = {total:0, customers:0, contacted:0, optionsSent:0, hot:0, attempts:0};
        grouped[d.agents].total++;
        if (d.status === 'CUSTOMER') grouped[d.agents].customers++;
        if (['CONTACTED','OPTIONS SENT','HOT','CUSTOMER'].includes(d.status)) grouped[d.agents].contacted++;
        if (d.status === 'OPTIONS SENT') grouped[d.agents].optionsSent++;
        if (d.status === 'HOT') grouped[d.agents].hot++;
        if (d.status === 'ATTEMPT') grouped[d.agents].attempts++;
      });
      return Object.entries(grouped).map(([agent, v]) => ({
        agent,
        ...v,
        conversion: safe(v.customers, v.total),
        engagement: safe(v.contacted, v.total),
        volume: v.total
      }));
    };

    const agents = getAgents();

    const rank = (key) => [...agents].sort((a,b)=>b[key]-a[key]);

    const filtered = category === 'all' ? agents : rank(category).slice(0,10);

    const trends = ['Q1','Q2','Q3','Q4'].map(q=>{
      const qd = data.filter(d=>d.quarter===q);
      const customers = qd.filter(d=>d.status==='CUSTOMER').length;
      return {quarter:q, customers, conversion: safe(customers, qd.length)};
    });

    if (!data.length) return null;

    return (
      <div className="p-4 md:p-8 fade-in">
        {/* Header */}
        <div className="flex flex-col md:flex-row justify-between items-center mb-6">
          <h1 className="text-3xl font-bold text-yellow-400 mb-2 md:mb-0">OSUS Leads Dashboard</h1>
          <div className="flex gap-2">
            {['Q1','Q2','Q3','Q4'].map(q=>(
              <button key={q} onClick={()=>setQuarter(q)}
                className={`px-4 py-2 rounded-lg font-semibold ${quarter===q?'bg-yellow-500 text-black':'bg-gray-700'}`}>
                {q}
              </button>
            ))}
          </div>
        </div>

        {/* KPI Cards */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          {[
            {label:'Leads',val: getQuarterData().length},
            {label:'Customers',val: getQuarterData().filter(d=>d.status==='CUSTOMER').length},
            {label:'Conversion',val: safe(getQuarterData().filter(d=>d.status==='CUSTOMER').length, getQuarterData().length)+'%'},
            {label:'Agents',val: new Set(getQuarterData().map(d=>d.agents)).size}
          ].map(k=>(
            <div key={k.label} className="bg-gray-800 rounded-xl p-4 text-center">
              <div className="text-2xl font-bold text-yellow-400">{k.val}</div>
              <div className="text-xs text-gray-400">{k.label}</div>
            </div>
          ))}
        </div>

        {/* Trends */}
        <div className="mb-6">
          <h2 className="text-xl font-semibold mb-2">Quarterly Trend</h2>
          <ResponsiveContainer width="100%" height={200}>
            <LineChart data={trends}>
              <CartesianGrid strokeDasharray="3 3" stroke="#444"/>
              <XAxis dataKey="quarter" stroke="#ccc"/>
              <YAxis stroke="#ccc"/>
              <Tooltip contentStyle={{backgroundColor:'#111'}}/>
              <Line type="monotone" dataKey="customers" stroke="#D4AF37" strokeWidth={2}/>
            </LineChart>
          </ResponsiveContainer>
        </div>

        {/* Filters */}
        <div className="flex gap-2 mb-4">
          {['all','conversion','volume','engagement'].map(c=>(
            <button key={c} onClick={()=>setCategory(c)}
              className={`px-3 py-1 rounded text-xs md:text-sm ${category===c?'bg-yellow-500 text-black':'bg-gray-700'}`}>
              {c.toUpperCase()}
            </button>
          ))}
        </div>

        {/* Rankings */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {filtered.map((a,i)=>(
            <div key={a.agent} className="bg-gray-800 rounded-xl p-4">
              <div className="flex items-center justify-between mb-2">
                <span className="font-bold text-yellow-400">{a.agent}</span>
                <span className="text-sm bg-gray-700 px-2 rounded">#{i+1}</span>
              </div>
              <div className="text-sm space-y-1">
                <div>Leads: <span className="font-bold">{a.volume}</span></div>
                <div>Customers: <span className="font-bold">{a.customers}</span></div>
                <div>Conversion: <span className="font-bold">{a.conversion}%</span></div>
              </div>
              {category==='conversion' && (
                <ResponsiveContainer width="100%" height={60}>
                  <BarChart data={[a]}>
                    <Bar dataKey="conversion" fill="#D4AF37"/>
                  </BarChart>
                </ResponsiveContainer>
              )}
            </div>
          ))}
        </div>
      </div>
    );
  };

  ReactDOM.render(<Dashboard/>, document.getElementById('root'));
</script>

</body>
</html>